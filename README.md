## çœŸé¦™è­¦å‘Šï¼šå³ä½¿ä¸ç”¨é¥¿äº†ä¹ˆè®¢é¤ï¼Œä¹Ÿè¯·åŠ¡å¿…æ”¶è—å¥½è¯¥åº“ï¼

### [Here is the English guide](https://github.com/KunMinX/Linkage-RecyclerView/blob/master/README_EN.md)

### ç”±æ¥

Linkage-RecyclerView æ˜¯ä¸€æ¬¾åŸºäº MVP æ¶æ„å¼€å‘çš„äºŒçº§è”åŠ¨åˆ—è¡¨æ§ä»¶ã€‚å®ƒæ˜¯å›  [â€œRxJava é­”æ³•å¸ˆâ€](https://github.com/KunMinX/RxJava2-Operators-Sample) è¿™ä¸ªé¡¹ç›®çš„éœ€æ±‚è€Œå­˜åœ¨ã€‚

åœ¨æœ€åˆå¯»éäº† GitHub ä¹Ÿæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å¼€æºåº“ï¼ˆé«˜åº¦è§£è€¦ã€å¯è¿œç¨‹ä¾èµ–ï¼‰ä¹‹åï¼Œæˆ‘å†³å¿ƒç ”ç©¶å‚è€ƒç°æœ‰å¼€æºé¡¹ç›®å…³äºäºŒçº§è”åŠ¨çš„é€»è¾‘ï¼Œå¹¶è‡ªå·±åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ª **é«˜åº¦è§£è€¦ã€è½»æ¾é…ç½®ã€å¯é€šè¿‡ Maven ä»“åº“è¿œç¨‹ä¾èµ–** çš„çœŸæ­£çš„ç¬¬ä¸‰æ–¹åº“ã€‚

Linkage-RecyclerView çš„ä¸ªæ€§åŒ–é…ç½®ååˆ†ç®€å•ï¼Œä¾æ‰˜äº MVP çš„ â€œé…ç½®è§£è€¦â€ ç‰¹æ€§ï¼Œä½¿ç”¨è€…æ— éœ€çŸ¥é“å†…éƒ¨çš„å®ç°ç»†èŠ‚ï¼Œä»…é€šè¿‡å®ç° Config ç±»å³å¯å®ŒæˆåŠŸèƒ½çš„å®šåˆ¶å’Œæ‰©å±•ã€‚

æ­¤å¤–ï¼Œåœ¨ä¸è®¾ç½®è‡ªå®šä¹‰é…ç½®çš„æƒ…å†µä¸‹ï¼ŒLinkage-RecyclerView æœ€å°‘åªéœ€ **ä¸€è¡Œä»£ç å³å¯è¿è¡Œèµ·æ¥**ã€‚

|                           RxJava Magician                            |                         Eleme Linear                         |                          Eleme Grid                          |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![7.gif](https://upload-images.jianshu.io/upload_images/57036-b4d61e70b43a07bb.gif) | ![2.gif](https://upload-images.jianshu.io/upload_images/57036-04b42bddcdd6cf39.gif) | ![3.gif](https://upload-images.jianshu.io/upload_images/57036-ada31ea077f0144d.gif) |



### ç›®æ ‡

Linkage-RecyclerView çš„ç›®æ ‡æ˜¯ï¼š**ä¸€è¡Œä»£ç å³å¯æ¥å…¥äºŒçº§è”åŠ¨åˆ—è¡¨**ã€‚



é™¤äº†ä¸€é”®æ¥å…¥è€Œçœå» 99% ä¸å¿…è¦çš„ã€å¤æ‚çš„ã€é‡å¤çš„å·¥ä½œå¤–ï¼Œä½ è¿˜å¯ä»¥ä»è¿™ä¸ªå¼€æºé¡¹ç›®è·å¾—çš„å†…å®¹åŒ…æ‹¬ï¼š

1. æ•´æ´çš„ä»£ç é£æ ¼å’Œæ ‡å‡†çš„èµ„æºå‘½åè§„èŒƒã€‚
2. **MVP æ¶æ„åœ¨ç¼–å†™ç¬¬ä¸‰æ–¹åº“ä¸­çš„æœ€ä½³å®è·µï¼šä½¿ç”¨è€…æ— éœ€äº†è§£å†…éƒ¨é€»è¾‘ï¼Œé€šè¿‡å®ç°æ¥å£å³å¯è½»æ¾å®Œæˆä¸ªæ€§åŒ–é…ç½®**ã€‚
3. ä¼˜ç§€çš„ä»£ç åˆ†å±‚å’Œå°è£…æ€æƒ³ï¼Œåœ¨ä¸åšä»»ä½•ä¸ªæ€§åŒ–é…ç½®çš„æƒ…å†µä¸‹ï¼Œä¸€è¡Œä»£ç å³å¯æ¥å…¥ã€‚
4. ä¸»ä½“å·¥ç¨‹åŸºäºå‰æ²¿çš„ã€éµå¾ªå…³æ³¨ç‚¹åˆ†ç¦»çš„ JetPack MVVM æ¶æ„ã€‚
5. AndroidX å’Œ Material Design 2 çš„å…¨é¢ä½¿ç”¨ã€‚
6. ConstraintLayout çº¦æŸå¸ƒå±€çš„æœ€ä½³å®è·µã€‚
7. ç»ä¸ä½¿ç”¨ Daggerï¼Œç»ä¸ä½¿ç”¨å¥‡æŠ€æ·«å·§ã€ç¼–å†™è‰°æ·±æ™¦æ¶©çš„ä»£ç ã€‚



å¦‚æœä½ æ­£åœ¨æ€è€ƒ [**å¦‚ä½•ä¸ºé¡¹ç›®æŒ‘é€‰åˆé€‚çš„æ¶æ„**](https://juejin.im/post/5cde5d7a51882525e968cdcd#heading-2) çš„è¯ï¼Œè¿™ä¸ªé¡¹ç›®å€¼å¾—ä½ å‚è€ƒï¼



### ç®€å•ä½¿ç”¨ï¼š

1.åœ¨ build.gradle ä¸­æ·»åŠ å¯¹è¯¥åº“çš„ä¾èµ–ã€‚

```groovy
implementation 'com.kunminx.linkage:linkage-recyclerview:1.9.2'
```

2.ä¾æ®é»˜è®¤çš„åˆ†ç»„å®ä½“ç±» `DefaultGroupedItem` çš„ç»“æ„å‡†å¤‡ä¸€ä¸²æ•°æ®ï¼ˆ**[ä»¥ä¸‹ä»¥  JSON ä¸ºä¾‹](#)**ï¼‰ã€‚

> æ³¨æ„è¿™é‡Œè®²çš„æ˜¯ "ä¸ºä¾‹" å“ˆï¼Œçœ‹åˆ°æœ‰äº›è®¿å®¢è¢«è¿™ä¸ª JSON è¿·æƒ‘ï¼Œ**è¯¯ä»¥ä¸ºåç«¯å¿…é¡»é€‚é…è¿™ä¸ª JSON æ ¼å¼çš„æ•°æ®**ã€‚

> ç»ä¸æ˜¯çš„ã€‚

> äº‹å®ä¸Šï¼Œ**Linkage-RecyclerView å®ä½“ç±»çš„è®¾è®¡ååˆ†çµæ´»**ï¼Œå¹¶ä¸”è£…è½½æ•°æ®çš„å…¥å‚åªæœ‰ `List<è‡ªå®šä¹‰Groupç±» extends BaseGroupedItem>`ï¼Œåœ¨å®é™…ç”Ÿäº§é¡¹ç›®ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥è‡ªå·±åœ¨æ•°æ®å±‚å¯¹æ‹¿åˆ°çš„åç«¯æ•°æ®è¿›è¡Œé€‚é…ï¼š

> åªéœ€éµç…§ä¸‹æ–‡ <a href="#custom">"ä¸ªæ€§åŒ–é…ç½®"</a> ä¸­äº¤ä»£çš„æ­¥éª¤ï¼Œæ ¹æ®å®é™…é¡¹ç›®æ‰€éœ€æ•°æ®æ ¼å¼æ¥ç»§æ‰¿ BaseGroupedItem å¹¶æ–°å»ºä¸€ä¸ª group ç±»ï¼Œç„¶ååœ¨ æ•°æ®å±‚æ‹¿åˆ°åç«¯è¯·æ±‚æ¥çš„æ•°æ®åï¼Œéå†åç«¯æ•°æ®ã€å°†åç«¯æ•°æ®å­—æ®µé€ä¸ªæ³¨å…¥åˆ° group å¯¹è±¡ä¸­ â€”â€” å¦‚æ­¤åœ¨æ•°æ®å±‚å®Œæˆé€‚é…ï¼Œå†æ¨é€ç»“æœç»™ UI å±‚å³å¯ã€‚

ğŸ‘†ğŸ‘†ğŸ‘† åˆ’é‡ç‚¹

```java
// DefaultGroupedItem.ItemInfo åŒ…å«ä¸‰ä¸ªå­—æ®µï¼š
String title //ï¼ˆå¿…å¡«ï¼‰äºŒçº§é€‰é¡¹çš„æ ‡é¢˜
String group //ï¼ˆå¿…å¡«ï¼‰äºŒçº§é€‰é¡¹æ‰€åœ¨åˆ†ç»„çš„åç§°ï¼Œè¦å’Œå¯¹åº”çš„ä¸€çº§é€‰é¡¹çš„æ ‡é¢˜ç›¸åŒ
String content //ï¼ˆé€‰å¡«ï¼‰äºŒçº§é€‰é¡¹çš„å†…å®¹
```

```json
[
  {
    "header": "ä¼˜æƒ ",
    "isHeader": true
  },
  {
    "isHeader": false,
    "info": {
      "content": "å¥½åƒçš„é£Ÿç‰©ï¼Œå¢è‚¥ç¥å™¨ï¼Œæœ‰æ±‚å¿…åº”",
      "group": "ä¼˜æƒ ",
      "title": "å…¨å®¶æ¡¶"
    }
  },
  {
    "header": "çƒ­å–",
    "isHeader": true
  },
  {
    "isHeader": false,
    "info": {
      "content": "çˆ†æ¬¾çƒ­å–ï¼Œæœˆé”€è¶…è¿‡ 999 ä»¶",
      "group": "çƒ­å–",
      "title": "çƒ¤å…¨ç¿…"
    }
  }
]

```

3.åœ¨å¸ƒå±€ä¸­å¼•å…¥ LinkageRecyclerView ã€‚

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <com.kunminx.linkage.LinkageRecyclerView
        android:id="@+id/linkage"
        android:layout_width="match_parent"
        android:layout_height="match_parent"/>

</LinearLayout>
```

4.åœ¨å¾—åˆ°æ•°æ®åï¼Œæœ€å°‘åªéœ€ä¸€è¡Œä»£ç å³å¯å®Œæˆåˆå§‹åŒ–ã€‚

```java
List<DefaultGroupedItem> items = gson.fromJson(...);

//ä¸€è¡Œä»£ç å®Œæˆåˆå§‹åŒ–
linkage.init(items);
```

æ³¨æ„ï¼šå¦‚ä½¿ç”¨ JSONï¼Œè¯·åœ¨ ProGuard Rules ä¸­ä¸ºè¯¥å®ä½“ç±»é…ç½®æ··æ·†ç™½åå•ï¼š

```java
-keep class com.kunminx.linkage.bean.** {*;}
```


### <a id="custom">ä¸ªæ€§åŒ–é…ç½®</a>ï¼š

è¯¥åº“ä¸ºä¸€çº§å’ŒäºŒçº§ Adapter åˆ†åˆ«å‡†å¤‡äº† Config æ¥å£ï¼ˆ`ILevelPrimaryAdapterConfig` å’Œ ` ILevelSecondaryAdapterConfig`ï¼‰ï¼Œ**è‡ªå®šä¹‰é…ç½®æ—¶ï¼Œå³æ˜¯å»å®ç°è¿™ä¸¤ä¸ªæ¥å£ï¼Œæ¥å–ä»£é»˜è®¤çš„é…ç½®**ã€‚

ä¹‹æ‰€ä»¥è®¾ç½®æˆæ¥å£çš„å½¢å¼ï¼Œè€Œé Builder çš„å½¢å¼ï¼Œæ˜¯å› ä¸ºäºŒçº§è”åŠ¨åˆ—è¡¨å†…éƒ¨çš„è”åŠ¨é€»è¾‘éœ€è¦æŒ‡æ˜å…³é”®çš„æ§ä»¶ã€‚æ¥å£ç›¸æ¯” Builder å…·æœ‰å¼ºåˆ¶æ€§ï¼Œèƒ½å¤Ÿè®©ä½¿ç”¨è€…ä¸€ç›®äº†ç„¶å¿…é¡»é…ç½®çš„å†…å®¹ï¼Œæ•…è€Œé‡‡ç”¨æ¥å£ï¼Œé€šè¿‡ MVP æ¶æ„çš„æ–¹å¼æ¥ç¼–å†™è¯¥åº“ã€‚

å…³äºä¸ªæ€§åŒ–é…ç½®ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘åœ¨ `ElemeGroupedItem` å’Œ `SwitchSampleFragment` ä¸­ç¼–å†™çš„æ¡ˆä¾‹ï¼š

### Step1ï¼šæ ¹æ®éœ€æ±‚æ‰©å±•å®ä½“ç±»

ä½ éœ€è¦æ ¹æ®éœ€æ±‚ï¼Œåœ¨ `BaseGroupedItem` çš„åŸºç¡€ä¸Šæ‰©å±•åˆ†ç»„å®ä½“ç±»ï¼Œå…·ä½“çš„åŠæ³•æ˜¯ï¼Œç¼–å†™ä¸€ä¸ªå®ä½“ç±»ï¼Œè¯¥å®ä½“ç±»é¡»ç»§æ‰¿äº `BaseGroupedItem`ï¼›è¯¥å®ä½“ç±»çš„å†…éƒ¨ç±» `ItemInfo` ä¹Ÿé¡»ç»§æ‰¿äº `BaseGroupedItem.ItemInfo`ã€‚

ä»¥ Eleme åˆ†ç»„å®ä½“ç±»ä¸ºä¾‹ï¼Œæ‰©å…… `content`ã€`imgUrl`ã€`cost` ä¸‰ä¸ªå­—æ®µï¼š

```java
public class ElemeGroupedItem extends BaseGroupedItem<ElemeGroupedItem.ItemInfo> {

    public ElemeGroupedItem(boolean isHeader, String header) {
        super(isHeader, header);
    }

    public ElemeGroupedItem(ItemInfo item) { super(item); }

    public static class ItemInfo extends BaseGroupedItem.ItemInfo {
        private String content;
        private String imgUrl;
        private String cost;

        public ItemInfo(String title, String group, String content) {
            super(title, group);
            this.content = content;
        }

        public ItemInfo(String title, String group, String content, String imgUrl) {
            this(title, group, content);
            this.imgUrl = imgUrl;
        }

        public ItemInfo(String title, String group, String content, String imgUrl, String cost) {
            this(title, group, content, imgUrl);
            this.cost = cost;
        }

        public String getContent() { return content; }

        public void setContent(String content) { this.content = content; }

        public String getImgUrl() { return imgUrl; }

        public void setImgUrl(String imgUrl) { this.imgUrl = imgUrl; }

        public String getCost() { return cost; }

        public void setCost(String cost) { this.cost = cost; }
    }
}
```

æ³¨æ„ï¼šå¦‚ä½¿ç”¨ JSONï¼Œè¯·åœ¨ ProGuard Rules ä¸­ä¸ºè¯¥å®ä½“ç±»é…ç½®æ··æ·†ç™½åå•ã€‚


### Step2ï¼šå®ç°æ¥å£ï¼Œå®Œæˆè‡ªå®šä¹‰é…ç½®

åœ¨è£…è½½æ•°æ®å’Œå®ç°è‡ªå®šä¹‰é…ç½®æ—¶ï¼Œæ³›å‹æ¡†ä¸­é¡»æŒ‡æ˜ä½ ç¼–å†™çš„å®ä½“ç±»ï¼Œæ³¨æ„ `List<ElemeLinkageItem>`ï¼Œä»¥åŠ `new ILevelSecondaryAdapterConfig<ElemeLinkageItem.ItemInfo>()` è¿™ä¸¤å¤„ã€‚

```java
private void initLinkageDatas(LinkageRecyclerView linkage) {
    List<ElemeGroupedItem> items = gson.fromJson(...);

    linkage.init(items, new ElemePrimaryAdapterConfig(), new ElemeSecondaryAdapterConfig());
}
    
private class ElemePrimaryAdapterConfig implements ILinkagePrimaryAdapterConfig {

    private Context mContext;

    public void setContext(Context context) { mContext = context; }

    @Override
    public int getLayoutId() { return R.layout.adapter_linkage_primary; }

    @Override
    public int getGroupTitleViewId() { return R.id.tv_group; }

    @Override
    public int getRootViewId() { return R.id.layout_group; }

    @Override
    public void onBindViewHolder(LinkagePrimaryViewHolder holder, boolean selected, String title) {
        TextView tvTitle = (TextView) holder.mGroupTitle;
        tvTitle.setText(title);
        tvTitle.setBackgroundColor(mContext.getResources().getColor(
                selected ? R.color.colorPurple : R.color.colorWhite));
        tvTitle.setTextColor(ContextCompat.getColor(mContext, 
                selected ? R.color.colorWhite : R.color.colorGray));
    }
}

private class ElemeSecondaryAdapterConfig implements
        ILinkageSecondaryAdapterConfig<ElemeGroupedItem.ItemInfo> {

    private Context mContext;

    public void setContext(Context context) { mContext = context; }

    @Override
    public int getGridLayoutId() { return 0; }

    @Override
    public int getLinearLayoutId() { return R.layout.adapter_eleme_secondary_linear; }

    @Override
    public int getHeaderLayoutId() { return R.layout.adapter_linkage_secondary_header; }
    
    @Override
    public int getFooterLayoutId() { return 0; }

    @Override
    public int getHeaderTextViewId() { return R.id.secondary_header; }

    @Override
    public int getSpanCountOfGridMode() { return SPAN_COUNT_FOR_GRID_MODE; }

    @Override
    public void onBindViewHolder(LinkageSecondaryViewHolder holder,
                                 BaseGroupedItem<ElemeGroupedItem.ItemInfo> item) {
        ((TextView) holder.getView(R.id.iv_goods_name)).setText(item.info.getTitle());
        holder.getView(R.id.iv_goods_item).setOnClickListener(v -> {
            //TODO
        });
    }

    @Override
    public void onBindHeaderViewHolder(LinkageSecondaryHeaderViewHolder holder,
                                       BaseGroupedItem<ElemeGroupedItem.ItemInfo> item) {
        ((TextView) holder.getView(R.id.secondary_header)).setText(item.header);
    }
    
    @Override
    public void onBindFooterViewHolder(LinkageSecondaryFooterViewHolder holder,
                                       BaseGroupedItem<DefaultGroupedItem.ItemInfo> item) {
        //TODO
    }
}
```



# Thanks to

[material-components-android](https://github.com/material-components/material-components-android)

[AndroidX](https://developer.android.google.cn/jetpack/androidx)

# My Pages

Emailï¼š[kunminx@gmail.com](mailto:kunminx@gmail.com)

Homeï¼š[KunMinX çš„ä¸ªäººåšå®¢](https://www.kunminx.com/)

Juejinï¼š[KunMinX åœ¨æ˜é‡‘](https://juejin.im/user/58ab0de9ac502e006975d757/posts)

[ã€Šé‡å­¦å®‰å“ã€‹ ä¸“æ ](https://xiaozhuanlan.com/kunminx?rel=kunminx)

[![é‡å­¦å®‰å“å°ä¸“æ ](https://i.loli.net/2019/06/17/5d067596c2dbf49609.png)](https://xiaozhuanlan.com/kunminx?rel=kunminx)


# License

```
Copyright 2018-2020 KunMinX

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
```

